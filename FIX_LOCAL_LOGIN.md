# 🔧 ローカル環境で名前入力画面が表示されない問題の解決方法

## ❌ 問題の症状

- `http://localhost:3002`で開いても、名前入力画面が表示されない
- Todo画面が直接表示される

---

## 🔍 原因と解決方法

### 原因1: localStorageに既に名前が保存されている（最も可能性が高い）

**確認方法：**

1. **ブラウザの開発者ツールを開く**（`F12`キー）

2. **「Console」タブを開く**

3. **以下のコードを実行：**
   ```javascript
   localStorage.getItem('todo-app-user-name')
   ```
   
   **結果：**
   - `null`が返される → 名前は保存されていない（他の原因の可能性）
   - 文字列が返される → 名前が保存されている（これが原因）

**解決方法1: ブラウザのコンソールでlocalStorageをクリア**

1. **開発者ツール（F12）の「Console」タブを開く**

2. **以下のコードを実行：**
   ```javascript
   localStorage.removeItem('todo-app-user-name')
   ```

3. **ページをリロード**（`F5`キー）

4. **名前入力画面が表示されることを確認**

**解決方法2: ログアウトボタンを使用**

1. **Todo画面が表示されている場合、右上の「ログアウト」ボタンをクリック**

2. **名前入力画面が表示されることを確認**

**解決方法3: シークレットウィンドウ（プライベートブラウジング）で開く**

1. **新しいシークレットウィンドウを開く**
   - Chrome/Edge: `Ctrl + Shift + N`
   - Firefox: `Ctrl + Shift + P`

2. **`http://localhost:3002`を開く**

3. **名前入力画面が表示されることを確認**

---

### 原因2: Supabase接続エラー（404エラーなど）

**確認方法：**

1. **開発者ツール（F12）の「Console」タブを開く**

2. **エラーメッセージを確認**
   - `404`エラーが表示されている場合 → 環境変数の問題
   - その他のエラー → エラー内容を確認

3. **「Network」タブを開く**
   - `supabase.co`へのリクエストが失敗していないか確認

**解決方法：**

1. **`.env.local`ファイルを確認**
   - プロジェクトのルートフォルダ（`package.json`がある場所）に`.env.local`ファイルがあるか確認
   - ファイルの内容が正しいか確認

2. **環境変数を確認：**
   ```env
   NEXT_PUBLIC_SUPABASE_URL=https://xxxxx.supabase.co
   NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
   ```

3. **開発サーバーを再起動**
   - PowerShellで`Ctrl + C`を押してサーバーを停止
   - `npm run dev`で再起動

---

### 原因3: デバッグログで確認

修正したコードには、デバッグログが追加されています。

**確認方法：**

1. **開発者ツール（F12）の「Console」タブを開く**

2. **ページをリロード**（`F5`キー）

3. **以下のようなログが表示されるか確認：**
   ```
   🔍 [DEBUG] ページ読み込み開始
   🔍 [DEBUG] hasUserName(): true または false
   🔍 [DEBUG] localStorageから名前を取得: [名前] または 名前が保存されていないため、名前入力画面を表示
   ```

4. **ログの内容を確認：**
   - `hasUserName(): true` → localStorageに名前が保存されている
   - `hasUserName(): false` → localStorageに名前が保存されていない

---

## ✅ すぐに試せる解決方法

### 方法1: localStorageをクリア（最も簡単）

**ブラウザのコンソール（F12 → Console）で以下を実行：**

```javascript
localStorage.removeItem('todo-app-user-name')
location.reload()
```

これで、ページがリロードされ、名前入力画面が表示されます。

### 方法2: ログアウトボタンを使用

1. **Todo画面の右上の「ログアウト」ボタンをクリック**
2. **名前入力画面が表示されることを確認**

### 方法3: シークレットウィンドウで確認

1. **新しいシークレットウィンドウを開く**（`Ctrl + Shift + N`）
2. **`http://localhost:3002`を開く**
3. **名前入力画面が表示されることを確認**

---

## 🔧 コードの修正内容

以下の修正を行いました：

1. **デバッグログを追加**
   - 開発環境（`NODE_ENV === 'development'`）でのみ表示
   - 問題の原因を特定しやすくなります

2. **エラーハンドリングを改善**
   - `getTodos`が失敗した場合でも、適切に処理されるようにしました

3. **ログアウト機能を追加**
   - Todo画面に「ログアウト」ボタンを追加
   - クリックすると、localStorageから名前を削除して名前入力画面を表示

---

## 🧪 動作確認

修正後、以下を確認してください：

1. **開発サーバーを再起動**
   ```powershell
   # サーバーを停止（Ctrl + C）
   npm run dev
   ```

2. **ブラウザで`http://localhost:3002`を開く**

3. **開発者ツール（F12）の「Console」タブを開く**

4. **デバッグログを確認**
   - ログが表示されれば、コードは正常に動作しています

5. **名前入力画面が表示されるか確認**
   - 表示されない場合は、localStorageをクリア（方法1を参照）

---

## 📝 まとめ

**最も可能性が高い原因：**
- **localStorageに既に名前が保存されている**

**最も簡単な解決方法：**
1. ブラウザのコンソール（F12 → Console）で以下を実行：
   ```javascript
   localStorage.removeItem('todo-app-user-name')
   location.reload()
   ```
2. または、Todo画面の「ログアウト」ボタンをクリック

**これで名前入力画面が表示されるはずです！**
