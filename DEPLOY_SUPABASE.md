# 🚀 Supabase対応Todoアプリのデプロイ手順

このガイドでは、Supabaseを使った本格的なログイン対応のTodoアプリをVercelにデプロイする手順を説明します。

---

## ✅ デプロイ前の確認

デプロイを始める前に、以下が完了していることを確認してください：

- ✅ Supabaseプロジェクトを作成済み
- ✅ データベーステーブルを作成済み（`users`、`todos`、`categories`）
- ✅ 認証ポリシーを設定済み
- ✅ ローカルで `.env.local` ファイルを作成し、アプリが正常に動作する
- ✅ GitHubリポジトリにコードをプッシュ済み

---

## 📦 ステップ1: 変更をGitHubにプッシュ

### 1-1. 変更を確認

PowerShellでプロジェクトのルートフォルダに移動して、変更を確認：

```powershell
cd C:\Users\tokam\Downloads\1
git status
```

**期待される結果：**
- Supabase関連のファイルが表示される
- 例：`lib/supabase/client.ts`、`lib/supabase/auth.ts` など

### 1-2. 変更をステージング

すべての変更をステージング（コミットの準備）：

```powershell
git add .
```

**注意：** `.env.local` ファイルは `.gitignore` に含まれているため、**自動的に除外されます**（これが正常です）。

### 1-3. 変更をコミット

変更にメッセージを付けてコミット：

```powershell
git commit -m "Add Supabase integration: login and database support"
```

**日本語でのメッセージ例：**
```powershell
git commit -m "Supabase対応：ログイン機能とデータベース連携を追加"
```

### 1-4. GitHubにプッシュ

変更をGitHubにアップロード：

```powershell
git push
```

**プッシュが成功した場合：**
- `Counting objects: ...` などのメッセージが表示される
- エラーがなければ成功です

---

## ⚙️ ステップ2: Vercelで環境変数を設定（重要！）

### 2-1. なぜ環境変数が必要なのか？

**重要なポイント：**
- `.env.local` ファイルはGitHubにアップロードされません（セキュリティのため）
- しかし、Vercelでアプリを動かすには、SupabaseのURLとキーが必要です
- そのため、**Vercelのダッシュボードで環境変数を手動で設定**する必要があります

### 2-2. Vercelダッシュボードを開く

1. ブラウザで [Vercelのダッシュボード](https://vercel.com/dashboard) を開く
2. ログインしていない場合は、GitHubアカウントでログイン
3. 自分のプロジェクト（例：`todo-app`）をクリック

### 2-3. プロジェクトの設定を開く

1. **「Settings」タブ**をクリック
2. 左側のメニューから **「Environment Variables」**をクリック

**画面の確認：**
- 「Environment Variables」という見出しがある
- 「Add New」というボタンがある

### 2-4. SupabaseのURLを設定

1. **「Add New」**ボタンをクリック
2. 以下の情報を入力：

   **Key（キー名）:**
   ```
   NEXT_PUBLIC_SUPABASE_URL
   ```
   
   **Value（値）:**
   ```
   ここにSupabaseのProject URLを貼り付け
   ```
   
   **例：**
   ```
   https://abcdefghijklmnop.supabase.co
   ```
   
   **💡 URLの取得方法：**
   - Supabaseダッシュボード → 「Settings」→「API」
   - 「Project URL」の値をコピー

3. **Environment（環境）の選択：**
   - ✅ **Production** にチェック（本番環境）
   - ✅ **Preview** にチェック（プレビュー環境）
   - ✅ **Development** にチェック（開発環境）
   - または、すべてにチェックを入れる

4. **「Save」**ボタンをクリック

### 2-5. Supabaseのキーを設定

1. もう一度 **「Add New」**ボタンをクリック
2. 以下の情報を入力：

   **Key（キー名）:**
   ```
   NEXT_PUBLIC_SUPABASE_ANON_KEY
   ```
   
   **Value（値）:**
   ```
   ここにSupabaseのanon public keyを貼り付け
   ```
   
   **例：**
   ```
   eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFiY2RlZmdoaWprbG1ub3AiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTYxNjIzOTAyMiwiZXhwIjoxOTMxODE1MDIyfQ.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   ```
   
   **💡 キーの取得方法：**
   - Supabaseダッシュボード → 「Settings」→「API」
   - 「Project API keys」セクションの「anon public」キーをコピー

3. **Environment（環境）の選択：**
   - ✅ **Production** にチェック
   - ✅ **Preview** にチェック
   - ✅ **Development** にチェック
   - または、すべてにチェックを入れる

4. **「Save」**ボタンをクリック

### 2-6. 環境変数の確認

設定した環境変数が表示されていることを確認：

- ✅ `NEXT_PUBLIC_SUPABASE_URL` が表示されている
- ✅ `NEXT_PUBLIC_SUPABASE_ANON_KEY` が表示されている

**画面の確認：**
- 2つの環境変数が一覧に表示されていればOK

---

## 🚀 ステップ3: デプロイを実行

### 3-1. 自動デプロイ（推奨）

**環境変数を設定したら：**
1. Vercelは自動的に再デプロイを開始します
2. 「Deployments」タブで進行状況を確認できます

**確認方法：**
1. Vercelのダッシュボードでプロジェクトを開く
2. **「Deployments」タブ**をクリック
3. 新しいデプロイが進行中または完了していることを確認

### 3-2. 手動で再デプロイ（必要な場合）

自動デプロイが開始されない場合：

1. Vercelのダッシュボードでプロジェクトを開く
2. **「Deployments」タブ**をクリック
3. 右上の **「Redeploy」** ボタンをクリック
4. **「Redeploy」**を確認

**再デプロイの理由：**
- 環境変数を設定しただけでは、既存のデプロイには反映されません
- 新しいデプロイを実行することで、環境変数が反映されます

---

## 🔍 ステップ4: デプロイの確認

### 4-1. デプロイが完了するまで待つ

**完了までの時間：**
- 通常、2〜5分程度かかります
- 「Ready」または「Build Completed」と表示されれば完了です

**進行状況の確認：**
- 「Deployments」タブで進行状況を確認できます
- 緑色のチェックマーク（✅）が表示されれば成功です

### 4-2. デプロイエラーの確認（エラーが出た場合）

**エラーメッセージを確認：**
1. **「Deployments」タブ**をクリック
2. 失敗したデプロイ（赤色のマーク）をクリック
3. エラーログを確認

**よくあるエラー：**

**エラー1: "Supabase環境変数が設定されていません"**
- **原因：** 環境変数が設定されていない、または名前が間違っている
- **解決方法：**
  1. 「Settings」→「Environment Variables」で環境変数を確認
  2. `NEXT_PUBLIC_SUPABASE_URL` と `NEXT_PUBLIC_SUPABASE_ANON_KEY` が正しく設定されているか確認
  3. 環境変数を設定した後、再デプロイを実行

**エラー2: "Build failed"**
- **原因：** ビルドエラー（通常はコードの問題）
- **解決方法：**
  1. エラーログを確認
  2. ローカルで `npm run build` を実行して、エラーを確認
  3. エラーを修正して、再度コミット・プッシュ

### 4-3. 公開サイトを確認

デプロイが完了したら：

1. **「Deployments」タブ**で完了したデプロイを確認
2. **「Visit」ボタン**をクリック
   - または、デプロイのURLをクリック
3. ブラウザで公開サイトが開く

---

## 🧪 ステップ5: 動作確認

### 5-1. 名前を入力してログイン

1. 公開サイトで名前入力画面が表示されることを確認
2. **自分の名前**を入力（例：`テストユーザー`）
3. **「開始」ボタン**をクリック
4. Todo画面に切り替われば成功です

**💡 確認ポイント：**
- ✅ 初回ログイン時、新しいユーザーがSupabaseデータベースに作成される
- ✅ 同じ名前で再ログインすると、同じTodoリストが表示される

### 5-2. Todoを作成して確認

1. **タイトル**を入力（例：`デプロイテスト`）
2. **説明**を入力（任意）
3. **期日**を選択（任意）
4. **カテゴリ**を選択または新規作成（任意）
5. **「Todoを作成」ボタン**をクリック
6. 作成したTodoが右側のTodo一覧に表示されれば成功です

**💡 確認ポイント：**
- ✅ Todoが正しく表示される
- ✅ Todoのチェックボックスをクリックすると完了状態が切り替わる
- ✅ Todoを削除できる
- ✅ ページをリロードしても、作成したTodoが表示される

### 5-3. 複数デバイスで確認

**異なるデバイス（スマホ、PCなど）で同じデータが見られるか確認：**

1. **スマホでブラウザを開く**
2. **公開サイトのURL**を入力
   - 例：`https://your-project.vercel.app`
3. **同じ名前でログイン**
   - PCと同じ名前を入力
4. **同じTodoリストが表示されることを確認**
   - PCで作成したTodoがスマホでも表示されれば成功です

---

## 🔄 ステップ6: 今後の更新方法

コードを変更して、変更を反映させる方法：

### 6-1. ローカルで変更を加える

1. コードを編集
2. ローカルで動作確認（`npm run dev`）

### 6-2. 変更をGitHubにプッシュ

```powershell
git add .
git commit -m "変更内容の説明"
git push
```

### 6-3. Vercelが自動的に再デプロイ

- `git push` すると、Vercelが自動的に検知して再デプロイを開始します
- 数分で完了します

**注意：**
- 環境変数は一度設定すれば、再デプロイ時も自動的に使用されます
- 環境変数を変更した場合は、Vercelのダッシュボードで再設定が必要です

---

## 🔍 トラブルシューティング

### エラー1: "Supabase環境変数が設定されていません"

**原因：** Vercelで環境変数が設定されていない

**解決方法：**
1. Vercelのダッシュボード → 「Settings」→「Environment Variables」を確認
2. `NEXT_PUBLIC_SUPABASE_URL` と `NEXT_PUBLIC_SUPABASE_ANON_KEY` が設定されているか確認
3. 設定されていない場合は、ステップ2の手順に従って設定
4. 環境変数を設定した後、**再デプロイを実行**（「Redeploy」ボタンをクリック）

### エラー2: Todoが作成されない

**原因：** データベース接続の問題、または認証ポリシーの問題

**解決方法：**
1. Supabaseダッシュボードの「Table Editor」でテーブルが存在するか確認
2. Supabaseダッシュボードの「Logs」でエラーを確認
3. 認証ポリシーが正しく設定されているか確認

### エラー3: ビルドエラー

**原因：** コードのエラーや依存関係の問題

**解決方法：**
1. ローカルで `npm run build` を実行して、エラーを確認
2. エラーを修正
3. 再度コミット・プッシュ

---

## ✅ 完了の確認

以下のすべてが確認できれば完了です：

1. ✅ デプロイが完了している（「Ready」と表示）
2. ✅ 公開サイトで名前を入力してログインできる
3. ✅ Todoを作成できる
4. ✅ Todoの完了/未完了を切り替えられる
5. ✅ Todoを削除できる
6. ✅ ページをリロードしても、作成したTodoが表示される
7. ✅ 複数デバイスで同じTodoリストが見られる

---

## 🎉 おめでとうございます！

Supabaseを使った本格的なログイン対応のTodoアプリがインターネット上に公開されました！

**次のステップ（オプション）：**
- カスタムドメイン（独自のURL）を設定する
- セキュリティを強化する（より厳密な認証ポリシーを設定）
- リアルタイム更新機能を追加する（Supabase Realtimeを使用）
